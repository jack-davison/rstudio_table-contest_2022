{"title":"Occupations of Black and White Americans in Georgia.","markdown":{"yaml":{"title":"Occupations of Black and White Americans in Georgia."},"headingText":"Table","containsRefs":false,"markdown":"\n\nThis plate shows the number of black Americans who live in urban and rural environments in 1890. There is almost a order of magnitude more black Americans living in the countryside than there are in cities.\n\nThis infographic is unusual in appearance, and [much has been said](https://www.smithsonianmag.com/history/first-time-together-and-color-book-displays-web-du-bois-visionary-infographics-180970826/) about its almost modernist style. While it starts as a regular bar chart with the green line representing large cities, it suddenly juts off at an angle, culminating in an absurdly large spiralling bar. The message I take from this is that the difference between the categories is so stark that it defies the traditional structure of the medium (in this case, the bar chart). This defiance is what I want to carry over to the tabular format.\n\nTo express this idea in a `{gt}` table, I've used a pretty typical in-line bar plot, but allowed it to spill over onto rows below. I think this nicely presents the message of \"this value is almost comically large compared to the others\" nicely. The mathematical transformations to get this result were interesting to write, and made good use of the lesser known `tidyr::uncount()` function.\n\n::: {.panel-tabset}\n\n\n```{r, ref.label=c('cityRuralCode')}\n#| label: cityRuralTbl\n#| echo: false\n```\n\n# Original\n\n![](https://raw.githubusercontent.com/ajstarks/dubois-data-portraits/master/challenge/challenge06/original-plate-11.jpg)\n\n# Code\n\n```{r}\n#| label: cityRuralCode\n#| eval: false\n\nlibrary(tidyverse)\nlibrary(gt)\n\n# read data\ncity_rural <-\n  readr::read_csv(\n    'https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2021/2021-02-16/city_rural.csv'\n  )\n\n# format for table\ntbl_data <-\n  city_rural |>\n  mutate(\n    Category = fct_inorder(Category),\n    n = Population / 100000,\n    n_ceil = ceiling(n) # n_ceil = number of \"100000\" chunks\n  ) |>\n  arrange(Category) |>\n  uncount(n_ceil) |> # uncount - get a row per 100000\n  mutate(val = if_else(n < 1, n * 100000, 100000)) |>\n  group_by(Category) |>\n  mutate(rn = row_number(),\n         val = if_else(rn == max(rn),\n                       100000 * (n - floor(n)),\n                       val)) # final row per group should be remainder of Population \n\n# function to create bars\nplot_bar <- function(data, color) {\n  data |>\n    ggplot(aes(y = \"\", x = val)) +\n    geom_col(fill = color) +\n    expand_limits(x = 100000) +\n    theme_void()\n}\n\n# create plots\nplots <-\n  tbl_data |>\n  group_by(Category, rn) |>\n  group_split() |>\n  map2(.y = c(\"#5f7767\", \"#6276ab\", \"#e1b323\", rep(\"#b82a40\", nrow(tbl_data) - 3)),\n       plot_bar)\n\n# create table\ntbl_data |>\n  # drop repeat values\n  mutate(\n    Category = if_else(rn == 1, as.character(Category), \"\"),\n    Population = if_else(rn == 1, as.character(Population), \"\")\n  ) |>\n  ungroup() |>\n  select(Category, Population) |>\n  mutate(plots = NA) |>\n  gt() |>\n  gtExtras::gt_theme_538() |>\n  tab_header(html(\"URBAN AND RURAL POPULATION.<br>1890.\")) |>\n  tab_options(heading.align = \"center\") |>\n  text_transform(cells_body(plots),\n                 function(x) {\n                   ggplot_image(plots, height = px(20), aspect_ratio = 9)\n                 })\n\n```\n\n:::"},"formats":{"html":{"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-yaml":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":true,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[]},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","css":["../../styles.css"],"toc":false,"output-file":"city_rural.html"},"language":{},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.1.189","theme":"cosmo","title":"Occupations of Black and White Americans in Georgia."},"extensions":{"book":{"multiFile":true}}}}}